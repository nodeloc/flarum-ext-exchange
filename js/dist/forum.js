(()=>{var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var o in r)t.o(r,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e);const r=flarum.core.compat["forum/app"];var o=t.n(r);const n=flarum.core.compat["common/extend"],a=flarum.core.compat["forum/components/UserPage"];var s=t.n(a);const i=flarum.core.compat["common/components/LinkButton"];var c=t.n(i);function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}function u(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,l(t,e)}const d=flarum.core.compat.Component;var h=t.n(d);const p=flarum.core.compat.app;var f=t.n(p);const g=flarum.core.compat["components/LoadingIndicator"];var y=t.n(g);const x=flarum.core.compat["components/Button"];var b=t.n(x);flarum.core.compat["components/Link"],flarum.core.compat["helpers/avatar"],flarum.core.compat["helpers/username"];var v=function(t){function e(){return t.apply(this,arguments)||this}return u(e,t),e.prototype.view=function(){var t=this.attrs.userExchangeHistory,e=t.created_at(),r=t.money(),o=t.type(),n=t.tx_hash();return m("tr",null,m("td",{style:"padding: 8px; border-bottom: 1px solid #ddd;"},e),m("td",{style:"padding: 8px; border-bottom: 1px solid #ddd;"},0===o?"能量转积分":"能量提现"),m("td",{style:"padding: 8px; border-bottom: 1px solid #ddd;"},r),m("td",{style:"padding: 8px; border-bottom: 1px solid #ddd;"},m("a",{href:"https://www.oklink.com/zh-hans/polygon/tx/"+n,target:"_blank"},n)))},e}(h());const w=flarum.core.compat["common/components/Modal"];var _=t.n(w);const N=flarum.core.compat["common/components/Button"];var k=t.n(N);const B=flarum.core.compat["common/utils/Stream"];var E=t.n(B);const O=flarum.core.compat["common/components/Alert"];var H=t.n(O),M=function(t){function e(){var e;return(e=t.call(this)||this).exchange_rate=o().forum.attribute("exchange_rate"),e.credits=E()("0"),e.loading=!1,e}u(e,t);var r=e.prototype;return r.className=function(){return"create-exchange Modal--small"},r.title=function(){return o().translator.trans("nodeloc-exchange.forum.create_exchange")},r.onsubmit=function(t){var e=this;t.preventDefault(),this.loading=!0,o().request({method:"POST",url:o().forum.attribute("apiUrl")+"/exchange",body:{credits:this.credits()}}).then((function(t){e.loading=!1,t.error?o().alerts.show({type:"error"},t.error):(o().alerts.show(H(),{type:"success"},"能量转换成功!"),e.hide())}))},r.onhide=function(){t.prototype.onhide.call(this),m.redraw()},r.content=function(){var t=this;return m("div",{className:"container buy-store-layer"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",{for:"buy-store-to-mail"},o().translator.trans("nodeloc-exchange.forum.input_help")),m("div",{className:"helpText"},o().translator.trans("nodeloc-exchange.forum.exchange_rate",{exchange_rate:this.exchange_rate})," "),m("input",{required:!0,id:"buy-store-to-mail",className:"FormControl",type:"number",bidi:this.credits})),m(k(),{className:"Button Button--primary",type:"submit",loading:this.loading,onclick:function(e){return t.onsubmit(e)}},"转换")))},e}(_()),P=function(t){function e(){var e;return(e=t.call(this)||this).exchange_rate=o().forum.attribute("exchange_rate"),e.credits=E()("0"),e.withdraw_address=E()(""),e.loading=!1,e}u(e,t);var r=e.prototype;return r.className=function(){return"create-exchange Modal--small"},r.title=function(){return o().translator.trans("nodeloc-exchange.forum.withdraw")},r.onsubmit=function(t){var e=this;t.preventDefault(),this.loading=!0,o().request({method:"POST",url:o().forum.attribute("apiUrl")+"/withdraw",body:{withdraw_address:this.withdraw_address(),credits:this.credits()}}).then((function(t){e.loading=!1,t.error?o().alerts.show({type:"error"},t.error):(o().alerts.show(H(),{type:"success"},"提现成功!"),e.hide())}))},r.onhide=function(){t.prototype.onhide.call(this),m.redraw()},r.content=function(){var t=this;return m("div",{className:"container buy-store-layer"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",{for:"withdraw"},o().translator.trans("nodeloc-exchange.forum.withdraw_address")),m("input",{required:!0,id:"withdraw",className:"FormControl",type:"text",bidi:this.withdraw_address}),m("label",{for:"withdraw"},o().translator.trans("nodeloc-exchange.forum.withdraw_amount")),m("input",{required:!0,id:"withdraw",className:"FormControl",type:"number",bidi:this.credits})),m(k(),{className:"Button Button--primary",type:"submit",loading:this.loading,onclick:function(e){return t.onsubmit(e)}},o().translator.trans("nodeloc-exchange.forum.withdraw"))))},e}(_()),R=function(t){function e(){return t.apply(this,arguments)||this}u(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.loading=!0,this.moreResults=!1,this.userExchangeHistory=[],this.user=this.attrs.params.user,this.loadResults()},r.view=function(){var t=this;return this.loading&&y().component({size:"large"}),m("div",null,m("div",{style:"padding-bottom:10px; font-size: 24px;font-weight: bold;"},f().translator.trans("nodeloc-exchange.forum.title")),m(b(),{class:"Button Button--primary",style:"margin-right:10px;",onclick:function(){f().modal.show(P,{onhide:function(){m.route.set(m.route.get())}})}},f().translator.trans("nodeloc-exchange.forum.withdraw")),m(b(),{class:"Button Button--primary",onclick:function(){f().modal.show(M,{onhide:function(){m.route.set(m.route.get())}})}},f().translator.trans("nodeloc-exchange.forum.create_exchange")),m("ul",{style:"margin: 0;padding: 0;list-style-type: none;position: relative;"},m("table",{style:"width: 100%; border-collapse: collapse; text-align: left;"},m("thead",null,m("tr",null,m("th",{style:"padding: 8px; border-bottom: 1px solid #ddd;"},f().translator.trans("nodeloc-exchange.forum.record.date")),m("th",{style:"padding: 8px; border-bottom: 1px solid #ddd;"},f().translator.trans("nodeloc-exchange.forum.record.type")),m("th",{style:"padding: 8px; border-bottom: 1px solid #ddd;"},f().translator.trans("nodeloc-exchange.forum.record.money-out")),m("th",{style:"padding: 8px; border-bottom: 1px solid #ddd;"},f().translator.trans("nodeloc-exchange.forum.record.tx-link")))),m("tbody",null,this.userExchangeHistory.map((function(t){return m("[",null,v.component({userExchangeHistory:t}))}))))),!this.loading&&0===this.userExchangeHistory.length&&m("div",null,m("div",{style:"font-size:1.4em;color: var(--muted-more-color);text-align: center;height: 300px;line-height: 100px;"},f().translator.trans("nodeloc-exchange.forum.list-empty"))),this.hasMoreResults()&&m("div",{style:"text-align:center;padding:20px"},m(b(),{className:"Button Button--primary",disabled:this.loading,loading:this.loading,onclick:function(){return t.loadMore()}},f().translator.trans("nodeloc-exchange.forum.money-list-load-more"))))},r.loadMore=function(){this.loading=!0,this.loadResults(this.userExchangeHistory.length)},r.parseResults=function(t){return this.moreResults=!!t.payload.links&&!!t.payload.links.next,[].push.apply(this.userExchangeHistory,t),this.loading=!1,m.redraw(),t},r.hasMoreResults=function(){return this.moreResults},r.loadResults=function(t){void 0===t&&(t=0);var e="/users/"+this.user.id()+"/exchange";return f().store.find(e,{filter:{user:this.user.id()},page:{offset:t}}).catch((function(){})).then(this.parseResults.bind(this))},e}(h()),j=function(t){function e(){return t.apply(this,arguments)||this}u(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.loadUser(m.route.param("username"))},r.content=function(){return m("div",{className:"Post-body"},R.component({params:{user:this.user}}))},e}(s());const S=flarum.core.compat["common/Model"];var F=t.n(S),q=function(t){function e(){return t.apply(this,arguments)||this}return u(e,t),e}(F());Object.assign(q.prototype,{money:F().attribute("money"),type:F().attribute("type"),tx_hash:F().attribute("tx_hash"),created_at:F().attribute("created_at")}),o().initializers.add("flarum-ext-exchange",(function(){o().store.models.userExchangeHistory=q,o().routes.userExchangeHistory={path:"/u/:username/exchange",component:j},(0,n.extend)(s().prototype,"navItems",(function(t){o().session.user&&!0===o().forum.attribute("canExchange")&&(o().session.user.id()!=this.user.id()&&o().session.user.attribute("canQueryExchange")||t.add("userExchangeHistory",c().component({href:o().route("userExchangeHistory",{username:this.user.slug()}),icon:"fa-solid fa-recycle"},o().translator.trans("nodeloc-exchange.forum.nav"))))}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map